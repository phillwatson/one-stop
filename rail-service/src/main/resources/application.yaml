mp:
  jwt:
    verify:
      audiences: ${one-stop.auth.access-token.audiences}
      issuer: ${one-stop.auth.access-token.issuer}
      publickey:
        location: http://user-service:8080/api/v1/auth/jwks.json
    token:
      header: Cookie
      cookie: ${one-stop.auth.access-token.cookie}

smallrye:
  jwt:
    jwks:
      refresh-interval: 15
      forced-refresh-interval: 5

# configure production datasource
"%prod":
  quarkus:
    datasource:
      db-kind: postgresql
      #username: one-stop
      #password: password
      jdbc:
        url: jdbc:postgresql://db:5432/one-stop

quarkus:
  flyway:
    migrate-at-start: true
    schemas: rails

  hibernate-orm:
    database:
      default-schema: rails

  rest-client:
    nordigen-api:
      url: https://ob.nordigen.com

  log:
    min-level: TRACE
    level: INFO
    console:
      format: "%d{yyyy-MM-dd HH:mm:ss,S} %-5p %X{correlationId} - [%c{3.}] (%t) %s%e%n"
    category:
      "io.quarkus.smallrye.jwt.runtime.auth.MpJwtValidator":
        level: INFO
      "org.jose4j.jwk":
        level: INFO
      "org.apache.kafka":
        level: WARN
      "com.hillayes":
        level: DEBUG

  native:
    resources:
      includes: "country-logos/**"

one-stop:
  rail:
    countries:
      - id: GB
        name: Great Britain
        flag-uri: /country-logos/gb.png
      - id: DE
        name: Germany
        flag-uri: country-logos/de.png
      - id: FR
        name: France
        flag-uri: country-logos/fr.png
      - id: IT
        name: Italy
        flag-uri: country-logos/it.png

    caches: # the duration of various caches - specified as Duration string
      institutions: PT6H
      account-details: PT5H

  scheduler:
    schema: ${quarkus.hibernate-orm.database.default-schema}
    tasks:
      # nightly task to check consents are still valid
      # and refresh all account details
      poll-all-consents:
        frequency:
          time-of-day: "02:00:00"
        on-failure:
          max-retry: 3
          retry-interval: PT1M

      # jobbing tasks to check the identified consent is still valid
      # and refresh the account details
      poll-consent:
        on-failure: # gives a max of 16 minutes
          max-retry: 4
          retry-interval: PT2M
          retry-exponent: 1.5

      # jobbing tasks to refresh the identified account details
      poll-account:
        on-failure: # gives a max of 16 minutes
          max-retry: 4
          retry-interval: PT2M
          retry-exponent: 1.5

  auth:
    access-token:
      cookie: 'access_token'
      issuer: https://hillayes.com/one-stop
      audiences: com.hillayes
    refresh-token:
      cookie: 'refresh_token'
      expires-in: "PT30M"
    xsrf:
      cookie-name: 'XSRF-TOKEN'
      header-name: 'X-XSRF-TOKEN'
      # secret: 'this will be passed in via docker env'
